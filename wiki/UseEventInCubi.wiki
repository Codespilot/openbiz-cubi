#summary Implement Event Observer in Openbiz Cubi (beta)
#labels Phase-Design

= Introduction =

In latest Openbiz framework, EventManager is a component designed for the following use cases:
 * Implementing simple subject/observer patterns.
 * Implementing Aspect-Oriented designs.
 * Implementing event-driven architectures.

The basic architecture allows you to attach and detach observers to named events, trigger events, and interrupt execution of observers.

= Basic Event Support in Openbiz Framework =

There are 3 new interfaces defined in the framework.

{{{
interface iEventManager 
{
	public function trigger($event_key, $target, $params);
	public function attach($event_key, $observer, $priority=null);
}

interface iEvent
{
	public function getName();
	public function getTarget();
	public function getParams();
}

interface iEventObserver
{
	public function observe($event);
}
}}}

And Openbiz includes very basic implementations of these interfaces.
 * class EventManager implements iEventManager
 * class Event implements iEvent
 * class EventObserver implements iEventObserver

== Trigger an Event ==

An EventManager is really only interesting if it triggers some events. Basic triggering takes three arguments: the event name, which is usually the current function/method name; the “context”, which is usually the current object instance; and the arguments, which are usually the arguments provided to the current function/method.
{{{
class UserDO
{
    // ... assume events definition from above

    public function deleteRecord($recordId)
    {
        $params = array('Id'=>$recordId);
        $this->getEventManager()->trigger(__FUNCTION__.'post', $this, $params);
    }
}
}}}

== Observe an Event ==

In turn, triggering events is only interesting if something is observing (listening) for the event. Observer attach to the EventManager, specifying a named event and pass its own object. The observers's observe method will be called with $event object passed in as an argument.
{{{
$observer = new MyEventObserver();
$user = new UserDO();
$user ->getEventManager()->attach('deleteRecord.post', $observer);

class MyEventObserver extends EventObserver
{
    public function observe($event)
    {
        $params = $event->getParams();
        BizSystem::log(LOG_DEBUG, $event->getName(), "Deleted Id is ".$params['Id']);
    }
}
}}}